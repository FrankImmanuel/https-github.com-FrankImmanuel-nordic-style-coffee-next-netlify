"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ImportTimestamp = exports.TIMESTAMP_INPUT_REGEX = void 0;
const tslib_1 = require("tslib");
const Either_1 = require("fp-ts/Either");
const function_1 = require("fp-ts/function");
const t = (0, tslib_1.__importStar)(require("io-ts"));
const validators_1 = require("../../../../validators");
const ImportContent_1 = require("../ImportContent");
exports.TIMESTAMP_INPUT_REGEX = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:(?:[+-]{1}\d{2}:?\d{2})|Z)$/;
const timestampValue = new t.Type("ImportTimestampValue", (u) => u instanceof Date, (u, c) => (0, function_1.pipe)(validators_1.String.validate(u, c), (0, Either_1.chain)((s) => {
    const date = new Date(s);
    const isInvalidDate = isNaN(date.getTime());
    if (isInvalidDate || !exports.TIMESTAMP_INPUT_REGEX.test(s)) {
        return t.failure(u, c, "The value must be a DateTime in the format YYYY-MM-DDTHH:MM:SS+0000");
    }
    return t.success(date);
})), t.identity);
exports.ImportTimestamp = (0, ImportContent_1.ImportContent)("Timestamp", (0, validators_1.NullOrElse)(timestampValue));
